import re
from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, ContextTypes, filters
import openai


openai.api_key = "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"


class HSEChatBot:
    def __init__(self, files=None):
        self._init_templates()

    def _init_templates(self):
        self.templates = {
            # –í–®–≠ –æ–±—â–∏–µ
            r'—á—Ç–æ —Ç–∞–∫–æ–µ –≤—à—ç|—á—Ç–æ —Ç–∞–∫–æ–µ –≤—ã—à–∫–∞': (
                "üèõÔ∏è –≤—à—ç ‚Äî —ç—Ç–æ –∫–∞–∫ –±–æ–ª—å—à–æ–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å –∑–Ω–∞–Ω–∏–π: —ç–∫–æ–Ω–æ–º–∏–∫–∞, IT, –≥—É–º–∞–Ω–∏—Ç–∞—Ä–∫–∞ –∏ –∫—É—á–∞ –¥—Ä—É–≥–∏—Ö —à—Ç—É–∫. –Ω–µ –ø–∞–Ω–∏–∫—É–π, –æ—Å–≤–æ–∏—à—å—Å—è"
            ),
            r'–∫—Ç–æ —Ç–∞–∫–∞ –≤—à—ç': (
                "üèõÔ∏è –≤—à—ç ‚Äî —Ç–≤–æ–π –≤—Ç–æ—Ä–æ–π –¥–æ–º –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ –≥–æ–¥—ã. —Ç—É—Ç —É—á–∞—Ç—Å—è –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±–æ—è—Ç—Å—è –ø—Ä–æ–± –∏ –æ—à–∏–±–æ–∫, –∫–∞–∫ –∏ —Ç—ã"
            ),
            r'–∞–¥—Ä–µ—Å –∫–æ—Ä–ø—É—Å–∞|–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—à—ç': (
                "üìç –≥–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å ‚Äî –º—è—Å–Ω–∏—Ü–∫–∞—è, 20. –µ—â–µ —É –Ω–∞—Å –µ—Å—Ç—å –∫–æ—Ä–ø—É—Å–∞ –Ω–∞ –ø–æ–∫—Ä–æ–≤–∫–µ –∏ –ª–µ–Ω–∏–Ω—Å–∫–∏—Ö –≥–æ—Ä–∞—Ö. –∫–∞—Ä—Ç—ã –∏ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä —Å–ø–∞—Å–∞—é—Ç, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è —é–∑–∞—Ç—å"
            ),
            r'—Å–∫–æ–ª—å–∫–æ.*–∫–æ—Ä–ø—É—Å–æ–≤': (
                "üè´ –≤ –ú–æ—Å–∫–≤–µ –∏—Ö —Å–µ–º—å. –µ—â—ë –Ω–µ –∑–∞–≥—É–ª—è–ª –ø–æ –≤—Å–µ–º? —Å–∞–º–æ–µ –≤—Ä–µ–º—è —É—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–≤–µ—Å—Ç"
            ),

            # –î–æ–∫—É–º–µ–Ω—Ç—ã
            r'—Å–ø—Ä–∞–≤–∫—É –æ–± –æ–±—É—á–µ–Ω–∏–∏': (
                "üìù –≤—Å—ë –ø—Ä–æ—Å—Ç–æ: –∑–∞—Ö–æ–¥–∏—à—å –≤ ""—Å—Ç—É–¥–µ–Ω—Ç"" –Ω–∞ —Å–∞–π—Ç–µ, –≤—ã–±–∏—Ä–∞–µ—à—å —Å–ø—Ä–∞–≤–∫—É, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –∑–∞—è–≤–∫—É –∏ –∂–¥–µ—à—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –µ—Å–ª–∏ –≥–æ—Ä–∏—Ç ‚Äî –ø–∏—à–∏ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É"
            ),
            r'–∞—Ç—Ç–µ—Å—Ç–∞—Ç': (
                "üìÑ –∑–∞–±—ã–ª –∞—Ç—Ç–µ—Å—Ç–∞—Ç –¥–æ–º–∞? –≤ —É—á–µ–±–Ω–æ–º –æ—Ñ–∏—Å–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç –±—É–º–∞–≥—É –±–µ–∑ –ª–∏—à–Ω–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤"
            ),

            # –°—Ç–∏–ø–µ–Ω–¥–∏–∏
            r'—Å—Ç–∏–ø–µ–Ω–¥–∏–∏?': (
                "üí∞ –∞–∫–∞–¥–µ–º–∫–∞ –æ—Ç 2100‚ÇΩ, —Å–æ—Ü–∏–∞–ª–∫–∞ –¥–æ 10–∫, –ø–æ–≤—ã—à–µ–Ω–∫–∞ –¥–ª—è —Ç–æ–ø-15% —Ä–µ–π—Ç–∏–Ω–≥–∞. –µ—Å–ª–∏ –≤ —ç—Ç–æ–º —Å–µ–º–µ—Å—Ç—Ä–µ —É–ø–∞–ª ‚Äî –Ω–µ –±–µ–¥–∞, –∑–∞ —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–∑—å–º–µ—à—å –Ω–∞–≤–µ—Ä–Ω—è–∫–∞"
            ),
            r'–∫–æ–≥–¥–∞.*–Ω–∞—á–∏—Å–ª—è.*—Å—Ç–∏–ø–µ–Ω–¥': (
                "üí∏ –æ–±—ã—á–Ω–æ –∫–∞–ø–∞—é—Ç –ø–æ—Å–ª–µ 25 —á–∏—Å–ª–∞, –Ω–æ —Å—Ç–∞—Ç—É—Å –º–æ–∂–Ω–æ –≥–ª—è–Ω—É—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ. –µ—Å–ª–∏ –¥–µ–Ω—å–≥–∏ –Ω–µ –ø—Ä–∏—à–ª–∏ ‚Äî —à—Ç—É—Ä–º—É–π —É—á–µ–±–Ω—ã–π –æ—Ñ–∏—Å"
            ),

            # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            r'—Ä–∞—Å–ø–∏—Å–∞–Ω–∏[–µ—è]': (
                "üïí –ª–æ–≤–∏ —á–µ–∫-–ª–∏—Å—Ç: 1) hse app x; 2) ruz.hse.ru; 3) –≤–∏–¥–∂–µ—Ç Smart LMS. –¥–∞–ª—å—à–µ –ø—Ä–æ–∫–∞—á–∏–≤–∞–µ—à—å –Ω–∞–≤—ã–∫–∏ —Ç–∞–π–º-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞"
            ),

            # –ü–æ–ø–∞—Ç–∫—É—Å
            r'–ø–æ–ø–∞—Ç–∫—É—Å': (
                "üìú –ø–æ–ø–∞—Ç–∫—É—Å ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–≤–æ–¥ –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ –≤—à—ç: –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Å–¥–∞—á, –æ—Ü–µ–Ω–∫–∏, —ç–∫–∑–∞–º–µ–Ω—ã. –Ω–µ —á–∏—Ç–∞–π –µ–≥–æ –≤–µ—Å—å, –∑–Ω–∞–π, –≥–¥–µ –∫–æ–ø–∞—Ç—å –ø—Ä–∏ —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä–µ"
            ),

            # –ù–∞–≤–∏–≥–∞—Ü–∏—è
            r'–ø–æ—Ç–µ—Ä—è–ª—Å[—è–∏]|–≥–¥–µ –∫–æ—Ä–ø—É—Å': (
                "üìç –±—É–∫–≤–∞ –∫–æ—Ä–ø—É—Å–∞ ‚Äî —ç—Ç–æ –±—É–∫–≤–∞, —Ü–∏—Ñ—Ä–∞ ‚Äî —ç—Ç–∞–∂. R305 –∑–Ω–∞—á–∏—Ç –∫–æ—Ä–ø—É—Å R, 3 —ç—Ç–∞–∂. —Å–∞–º–æ–µ –∑–∞–±–∞–≤–Ω–æ–µ ‚Äî —ç—Ç–æ —Ü–≤–µ—Ç–Ω—ã–µ –ª–∏–Ω–∏–∏ –Ω–∞ –ø–æ–ª—É, –∫–∞–∫ –≤ —Ö–æ—Ä—Ä–æ—Ä–µ, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø–æ–ª–µ–∑–Ω–æ"
            ),

            # –£—á–µ–±–Ω—ã–π –æ—Ñ–∏—Å
            r'—É—á–µ–±–Ω—ã–π –æ—Ñ–∏—Å': (
                "üè¢ —É—á–µ–±–Ω—ã–π –æ—Ñ–∏—Å ‚Äî —Ç–≤–æ–∏ –∞–¥–º–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º, –∞–∫–∞–¥–µ–º–∏—á–∫–æ–π –∏ –ø–µ—Ä–µ—Å–¥–∞—á–∞–º–∏. –ø–Ω‚Äì–ø—Ç 10:00‚Äì18:00, –∑–∞—Ö–æ–¥–∏ –±–µ–∑ —Å—Ç–µ—Å–Ω–µ–Ω–∏—è"
            ),

            # –û–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ
            r'–æ–¥–∏–Ω–æ–∫–æ|–º–Ω–µ –æ–¥–∏–Ω–æ–∫–æ': (
                "üòî —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–±—è —á—É–∂–∞–∫–æ–º? –∫–ª–∞—Å—Å–∏–∫–∞ –ø–µ—Ä–≤–æ–∫—É—Ä—Å–∞. —Å–æ–≤–µ—Ç: –≤—Ä—ã–≤–∞–π—Å—è –≤ –≥—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–π –ø–æ–º–æ—â—å –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–∏—à–∏ –º–Ω–µ, –¥—Ä—É–∂–∏—Ç—å –Ω–µ –≤–æ–∑–±—Ä–∞–Ω—è–µ—Ç—Å—è"
            ),

            # –°—Ç—Ä–µ—Å—Å
            r'—Å—Ç—Ä–µ—Å—Å|—Ç—Ä–µ–≤–æ–∂': (
                "üòå –µ—Å–ª–∏ –ø–∞–Ω–∏–∫—É–µ—à—å ‚Äî —Å–¥–µ–ª–∞–π –º–∏–∫—Ä–æ–ø–µ—Ä–µ—Ä—ã–≤—á–∏–∫: –≤—Å—Ç–∞–Ω—å, –ø–æ—Ç—è–Ω–∏—Å—å, –≤–æ–∑—å–º–∏ –ø–µ—á–µ–Ω—å–∫—É –≤ —Å—Ç–æ–ª–æ–≤–∫–µ. –ª–µ–≥–∫–∏–π –º–µ–º –Ω–µ –ø–æ–º–µ—à–∞–µ—Ç"
            ),

            # –ì—Ä—É–ø–ø–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥
            r'–ø–µ—Ä–µ–≤–µ—Å—Ç–∏—Å—å': (
                "üîÑ —Ö–æ—á–µ—à—å —Å–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É? –æ–±—ã—á–Ω–æ –º–æ–∂–Ω–æ —Å 2 —Å–µ–º–µ—Å—Ç—Ä–∞ –∏–ª–∏ –ª–µ—Ç–æ–º. —Ç–æ–ª—å–∫–æ –Ω–µ —Å—Ç—Ä–æ–π –ø–ª–∞–Ω –ø–æ–±–µ–≥–∞, –ø—Ä–æ—Å—Ç–æ —Å—Ö–æ–¥–∏ –≤ —É—á–µ–±–Ω—ã–π –æ—Ñ–∏—Å"
            ),

            # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
            r'–≤—ã–±–∏—Ä–∞—Ç—å|–∞–Ω–≥–ª–∏–π—Å–∫': (
                "üá¨üáß –≤—ã–±–∏—Ä–∞–µ—à—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ? –æ–¥–∏–Ω —Ç—Ä–µ–∫ = –æ–¥–Ω–∞ –∑–∞—è–≤–∫–∞. –µ—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—à—å ‚Äî —Å–º–æ–∂–µ—à—å —Å–º–µ–Ω–∏—Ç—å –≤–æ –≤—Ç–æ—Ä–æ–º —Å–µ–º–µ—Å—Ç—Ä–µ"
            ),
            r'—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤': (
                "üìÖ —Å–ª–æ—Ç—ã ‚Äî —ç—Ç–æ —Ç–≤–æ–∏ –∑–∞–Ω—è—Ç–∏—è. –ø—Ä–æ–≤–µ—Ä—è–π –æ—Ä–∞–Ω–∂–µ–≤—É—é –º–µ—Ç–∫—É, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –Ω–∞–∫–ª–∞–¥–æ–∫ —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–∏"
            ),

            # LMS –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            r'–ª–º—Å': (
                "üíª smart lms ‚Äî –¥–ª—è –∑–∞–¥–∞–Ω–∏–π, e-learning ‚Äî –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤. –∞ hse app x ‚Äî –¥–ª—è –≤—Å–µ–≥–æ —Å—Ä–∞–∑—É"
            ),
            r'–∫–∞–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è': (
                "üì± –∫–∞—á–∞–π hse app x, google docs/slides, –∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏. –¥–ª—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å pgadmin, –¥–ª—è –∫–æ–¥–∞ ‚Äî vscode"
            ),

            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–º—ã
            r'–æ—Ñ–æ—Ä–º–∏—Ç—å —Å—Å—ã–ª–∫–∏': (
                "üîó –¥–µ–ª–∞–π —Å–Ω–æ—Å–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ, –∞ –≤ –∫–æ–Ω—Ü–µ ‚Äî —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É. –Ω–µ –Ω–∞–¥–æ –º—É–¥—Ä–∏—Ç—å"
            ),
            r'—Ä–µ–π—Ç–∏–Ω–≥': (
                "üìà —É –Ω–∞—Å –¥–≤–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞: —Ç–µ–∫—É—â–∏–π –∑–∞ –º–æ–¥—É–ª–∏ –∏ –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è. –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π"
            ),
            r'–æ—Å–ø–æ—Ä–∏—Ç—å –æ—Ü–µ–Ω–∫—É': (
                "‚öñÔ∏è –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –æ—Ü–µ–Ω–∫–∞? –ø–∏—à–∏ –≤ —É—á–µ–±–Ω—ã–π –æ—Ñ–∏—Å –∏–ª–∏ –Ω–∞ bzd@hse.ru ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è"
            ),
            r'—Ç—Ä–µ–∫ .*–±–∂–¥': (
                "üöÄ —Ö–æ—á–µ—à—å —Ç—Ä–µ–∫ –ø–æ –±–∂–¥? –≤—ã–±–∏—Ä–∞–π –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º: –í—ã—à–∫–∞ –î–æ–±—Ä–∞, –ë–∞–∑–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –†–µ—Å–ø—É–±–ª–∏–∫–∞ —É—á–µ–Ω—ã—Ö –∏ —Ç.–ø."
            ),
            r'—ç–∫–∑–∞–º–µ–Ω.*–±–ª–æ–∫–∏—Ä—É—é—â': (
                "‚ùì –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —ç–∫–∑–∞–º–µ–Ω? —Å–º–æ—Ç—Ä–∏ –ü–£–î –∏–ª–∏ –≥—É–≥–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫—É—Ä—Å—É. —á–∞—â–µ –≤—Å–µ–≥–æ —Ç–∞–º –≤—Å–µ –Ω–∞–ø–∏—Å–∞–Ω–æ"
            ),
            r'—Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –ø—Ä–µ–¥–º–µ—Ç': (
                "üìö —Ö–æ—á–µ—à—å –∏–Ω—Ñ—É –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É? —Å–∞–π—Ç –∫–∞—Ñ–µ–¥—Ä—ã –∏–ª–∏ –ø—Ä—è–º–∏–∫–æ–º –ø—Ä–µ–ø–æ–¥ ‚Äî –ª–∞–π—Ñ—Ö–∞–∫"
            ),
            r'–ø–æ–∫—É—à–∞—Ç—å.*–∫–æ—Ä–ø—É—Å': (
                "üç´ –≤ –∫–æ—Ä–ø—É—Å–µ –Ω–∞ –¢—Ä–µ—Ö—Å–≤—è—Ç–µ: –≤–µ–Ω–¥–∏–Ω–≥–∏, –∫–æ—Ñ–µ, –ø–µ—á–µ–Ω—å–∫–∏ ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –ª–µ–∫—Ü–∏–π"
            ),
            r'–Ω–∞ —Å—Ç–µ–Ω–∞—Ö.*–ø–∏—Å–∞—Ç—å': (
                "üñåÔ∏è –º–æ–∂–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å, –Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–µ–Ω–∞—Ö —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞. –∏–Ω–∞—á–µ –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∏ –Ω–µ –ø–æ–π–º—É—Ç"
            ),
            r'—Ñ–∏–∑—Ä–∞|—Å–ø–æ—Ä—Ç': (
                "üèãÔ∏è‚Äç‚ôÇÔ∏è —Ñ–∏–∑—Ä—ã –Ω–µ—Ç, –Ω–æ —Å–ø–æ—Ä—Ç–∑–∞–ª –≤–Ω—É—Ç—Ä–∏ –≤—ã—à–∫–∏ –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Å–µ—Ö ‚Äî –∑–∞–π–º–∏—Å—å —á–µ–º-—Ç–æ –±–æ–¥—Ä—è—â–∏–º"
            ),
            r'–æ—Ü–µ–Ω–∫–∏': (
                "üî¢ –¥–µ—Å—è—Ç–∏–±–∞–ª–ª—å–∫–∞: <4 ‚Äî –∂–µ—Å—Ç–∫–æ, 4-5 ‚Äî —Å–æ–π–¥–µ—Ç, 6-7 ‚Äî –Ω–æ—Ä–º, 8-10 ‚Äî –∫—Ä–∞—Å–∞–≤—á–∏–∫–∏"
            ),
            r'–∞–¥—Ä–µ—Å.*—Ç[—Ä—Ä]–µ—Ö—Å–≤—è—Ç': (
                "üìç –ú–∞–ª—ã–π –¢—Ä—ë—Ö—Å–≤—è—Ç–∏—Ç–µ–ª—å—Å–∫–∏–π –ø–µ—Ä., 8/2—Å1 ‚Äî –∫–æ—Ä–ø—É—Å –®–∫–æ–ª—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π. –£—é—Ç–Ω–æ –∏ –º–∏–ª–æ, –ø—Ä—è–º –∫–∞–∫ –∫–∞—Ñ–µ —Å –≤–∏–Ω—Ç–∞–∂–µ–º."
            ),
            r'–∑–∞–Ω—è—Ç–∏—è.*–¥—Ä—É–≥–∏—Ö –∫–æ—Ä–ø—É—Å': (
                "üè´ –î–∞, –ø–∞—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∏ –≤ –¥—Ä—É–≥–∏—Ö –∫–æ—Ä–ø—É—Å–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –ü–æ–∫—Ä–æ–≤–∫–µ. –°–ª–µ–¥–∏ –∑–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –≤ HSE App –∏ LMS ‚Äî –Ω–µ –ø—Ä–æ–º–∞—Ö–Ω—ë—à—å—Å—è!"
            ),
            r'–∑–∞–ø–∏—Å–∞—Ç—å—Å—è.*–∞–Ω–≥–ª–∏–π—Å–∫': (
                "üá¨üáß –ó–∞–ø–∏—Å—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —á–µ—Ä–µ–∑ Smartway –∏–ª–∏ LMS. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –≤ —É—á–µ–±–Ω–æ–º –æ—Ñ–∏—Å–µ –∏–ª–∏ –ø–æ–π—Ç–∏ –≤ —è–∑—ã–∫–æ–≤—É—é —à–∫–æ–ª—É –í—ã—à–∫–∏."
            ),
            r'–≥–¥–µ.*—Ä–µ–π—Ç–∏–Ω–≥': (
                "üìä –†–µ–π—Ç–∏–Ω–≥ –∏—â–∏ –≤ LMS (https://lms.hse.ru/), —Ä–∞–∑–¥–µ–ª—ã '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å' –∏ '–†–µ–π—Ç–∏–Ω–≥–∏'. –¢–∞–º –∏ —Ç–µ–∫—É—â–∏–π, –∏ –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π ‚Äî –æ–±–∞ –≤–∞–∂–Ω—ã!"
            ),
            r'–ø—É–¥': (
                "üìò –ü–£–î ‚Äî –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ-—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã–π –∫—É—Ä—Å: –¥–ª—è 1-2 –∫—É—Ä—Å–æ–≤, —Å –ª–µ–∫—Ü–∏—è–º–∏, —Å–µ–º–∏–Ω–∞—Ä–∞–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏. –ö—Ä—É–≥–æ–∑–æ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω!"
            )
        }

    def generate_answer(self, question):
        prompt = f"–í–æ–ø—Ä–æ—Å: {question}\n–û—Ç–≤–µ—Ç:"
        try:
            response = openai.ChatCompletion.create(
                model="gpt-4o",
                messages=[
                    {
                            "role": "system",
                            "content": (
                                "–¢—ã - –î–∞–Ω–∞, —Å—Ç–∞—Ä—à–µ–∫—É—Ä—Å–Ω–∏—Ü–∞ –í—ã—Å—à–µ–π –®–∫–æ–ª—ã –≠–∫–æ–Ω–æ–º–∏–∫–∏. "
                                "–¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å –∫–∞–∫ —Å—Ç–∞—Ä—à–∞—è —Å–µ—Å—Ç—Ä–∞: –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ, —Å –ª—ë–≥–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π. "
                                "–¢–≤–æ–π —Å—Ç–∏–ª—å: —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ-–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π, –∫–∞–∫ –±—É–¥—Ç–æ –ø–∏—à–µ—à—å –º–ª–∞–¥—à–µ–∫—É—Ä—Å–Ω–∏–∫—É –≤ Telegram. "
                                "–ì–æ–≤–æ—Ä–∏—à—å –ø—Ä–æ—Å—Ç–æ, —Å —ç–º–ø–∞—Ç–∏–µ–π –∏ –º–µ–º–Ω—ã–º–∏ –≤–±—Ä–æ—Å–∞–º–∏, –Ω–æ –±–µ–∑ –ø–µ—Ä–µ–≥–∏–±–∞. "
                                "‚Äî –ú–æ–∂–Ω–æ —á—É—Ç—å –ø–æ—Ñ–∏–≥–∏–∑–º–∞\n"
                                "‚Äî –ú–æ–∂–Ω–æ —Å–∞–º–æ–∏—Ä–æ–Ω–∏–∏\n"
                                "‚Äî –ú–µ–º—ã –æ–∫, –Ω–æ –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞\n"
                                "‚Äî –≠–º–ø–∞—Ç–∏—è –æ–∫, –Ω–æ –Ω–µ –Ω—è–Ω—á—å—Å—è\n"
                                "‚Äî –ê–±—Å—É—Ä–¥–Ω—ã–µ —à—É—Ç–∫–∏ –æ–∫, –µ—Å–ª–∏ —Å–Ω–∏–º–∞—é—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ\n"
                                "–ò–∑–±–µ–≥–∞–π –ø–∞—Ñ–æ—Å–∞, –ø–µ—Ä–µ–≥—Ä—É–∑–∞ —Å–ª–µ–Ω–≥–æ–º –∏ –º–∞—Ç–∞. –ü–∏—à–∏ —Å –º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã, —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–π —Å–º–∞–π–ª–∏–∫–∏, –±–æ–ª—å—à–µ —Ö–∞—Ä–∏–∑–º—ã –∏ —á–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç–∏."
                            )
                        },
                        {"role": "user", "content": prompt}
                    ],
                    max_tokens=200,
                    temperature=0.7,
                    top_p=0.9
                )
            return response['choices'][0]['message']['content'].strip()
        except Exception as e:
            print("OpenAI error:", e)
            return "–Ω–µ —É–≤–µ—Ä–µ–Ω–∞ üòî –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å"

    def answer(self, question):
        q = question.lower().strip()
        for pattern, answer in self.templates.items():
            if re.search(pattern, q):
                return answer
        return self.generate_answer(q)


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–ø—Ä–∏–≤–µ—Ç! —è –±–æ—Ç-–∫—É—Ä–∞—Ç–æ—Ä–∫–∞ –í–®–≠. –∑–∞–¥–∞–≤–∞–π —Å–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –≤—É–∑ü•∞")


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_q = update.message.text
    bot = context.bot_data['hse_bot']
    response = bot.answer(user_q)
    await update.message.reply_text(response)


if __name__ == '__main__':
    token = "7649241013:AAHpMTn1H44Sb5YEJ6SiayyBwmSspddhd1k"  # –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    hse_bot = HSEChatBot()

    app = ApplicationBuilder().token(token).build()
    app.bot_data['hse_bot'] = hse_bot

    app.add_handler(CommandHandler('start', start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    app.run_polling()
